{% extends 'main/base.html' %}
{% load static %}
{% block title %}ИИ-помощник — UniQuest{% endblock %}

{% block content %}
<div class="row mb-4">
  <div class="col-12">
    <div class="d-flex align-items-center mb-3">
      <div class="me-3">
        <i class="fas fa-robot fa-3x text-primary"></i>
      </div>
      <div>
        <h1 class="mb-1">ИИ-помощник</h1>
        <p class="text-muted mb-0">
          Умный поиск по учебным материалам
          {% if specialty %}
            <span class="badge bg-info ms-2">{{ specialty.name_ru }}</span>
          {% endif %}
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Поисковая форма -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body p-4">
        <form method="get" action="{% url 'ai_assistant' %}">
          <div class="input-group input-group-lg">
            <span class="input-group-text bg-primary text-white">
              <i class="fas fa-search"></i>
            </span>
            <input 
              type="text" 
              name="q" 
              class="form-control" 
              placeholder="Задайте вопрос о вашей специальности, курсах или учебных материалах..."
              value="{{ query }}"
              autofocus
            >
            <button class="btn btn-primary" type="submit">
              <i class="fas fa-paper-plane me-2"></i>Найти
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% if query %}
  <!-- Результаты поиска -->
  <div class="row mb-4">
    <div class="col-12">
      <h3 class="mb-3">
        <i class="fas fa-list me-2"></i>Результаты поиска
        <small class="text-muted">(найдено: {{ search_results|length }})</small>
      </h3>
      
      {% if search_results %}
        <div class="row g-4">
          {% for result in search_results %}
            <div class="col-md-6">
              <div class="card h-100 shadow-sm">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <h5 class="card-title mb-0">
                      <i class="fas fa-book-open me-2 text-primary"></i>
                      {{ result.title }}
                    </h5>
                    {% if result.score %}
                      <span class="badge bg-success">
                        {{ result.score|floatformat:2 }}
                      </span>
                    {% endif %}
                  </div>
                  
                  {% if result.lecture and result.lecture.course %}
                    <p class="text-muted small mb-2">
                      <i class="fas fa-graduation-cap me-1"></i>
                      Курс: <a href="{% url 'course_detail' result.lecture.course.id %}">{{ result.lecture.course.name }}</a>
                    </p>
                  {% endif %}
                  
                  <p class="card-text">{{ result.snippet }}</p>
                  
                  <div class="mt-3">
                    {% if result.lecture and result.lecture.id %}
                      <a href="{% url 'lecture_detail' result.lecture.id %}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-eye me-1"></i>Читать полностью
                      </a>
                    {% elif result.url %}
                      <a href="{{ result.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-external-link-alt me-1"></i>Открыть ссылку
                      </a>
                    {% elif result.id %}
                      <a href="{% url 'lecture_detail' result.id %}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-eye me-1"></i>Читать полностью
                      </a>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-info text-center">
          <i class="fas fa-info-circle fa-2x mb-3"></i>
          <h5>Ничего не найдено</h5>
          <p>Попробуйте изменить запрос или использовать другие ключевые слова.</p>
        </div>
      {% endif %}
    </div>
  </div>
{% else %}
  <!-- Предлагаемые вопросы -->
  {% if suggested_questions %}
    <div class="row mb-4">
      <div class="col-12">
        <h3 class="mb-3">
          <i class="fas fa-lightbulb me-2 text-warning"></i>Попробуйте спросить:
        </h3>
        <div class="row g-3">
          {% for question in suggested_questions %}
            <div class="col-md-6">
              <div class="card h-100 hover-shadow">
                <div class="card-body">
                  <p class="card-text mb-0">{{ question }}</p>
                  <a href="{% url 'ai_assistant' %}?q={{ question|urlencode }}" class="btn btn-sm btn-outline-primary mt-2">
                    <i class="fas fa-search me-1"></i>Найти ответ
                  </a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}
  
  <!-- Популярные вопросы по специальности -->
  {% if popular_questions %}
    <div class="row mb-4">
      <div class="col-12">
        <h3 class="mb-3">
          <i class="fas fa-star me-2 text-warning"></i>Популярные вопросы по вашей специальности:
        </h3>
        <div class="row g-3">
          {% for question in popular_questions %}
            <div class="col-md-4">
              <div class="card h-100">
                <div class="card-body text-center">
                  <i class="fas {{ question.icon }} fa-2x text-primary mb-3"></i>
                  <p class="card-text">{{ question.text }}</p>
                  <a href="{% url 'ai_assistant' %}?q={{ question.text|urlencode }}" class="btn btn-sm btn-primary">
                    <i class="fas fa-search me-1"></i>Найти
                  </a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}
  
  <!-- Информация о функциях -->
  <div class="row">
    <div class="col-12">
      <div class="card bg-light">
        <div class="card-body">
          <h5 class="card-title">
            <i class="fas fa-info-circle me-2"></i>Как работает ИИ-помощник?
          </h5>
          <div class="row">
            <div class="col-md-4 mb-3">
              <div class="d-flex align-items-start">
                <i class="fas fa-brain fa-2x text-primary me-3"></i>
                <div>
                  <h6>Семантический поиск</h6>
                  <p class="small text-muted mb-0">Использует искусственный интеллект для понимания смысла вашего вопроса</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="d-flex align-items-start">
                <i class="fas fa-filter fa-2x text-success me-3"></i>
                <div>
                  <h6>Фильтрация по курсам</h6>
                  <p class="small text-muted mb-0">Приоритет отдается материалам из ваших курсов</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="d-flex align-items-start">
                <i class="fas fa-graduation-cap fa-2x text-info me-3"></i>
                <div>
                  <h6>По специальности</h6>
                  <p class="small text-muted mb-0">Предлагает вопросы, релевантные вашей специальности</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endif %}

<style>
  .hover-shadow {
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .hover-shadow:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1) !important;
  }
</style>
{% endblock %}

